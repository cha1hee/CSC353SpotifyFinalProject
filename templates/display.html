<!DOCTYPE html>
<html lang="en">
  <head>
    <title>CSC353 Final Project</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../styles.css" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We"
      crossorigin="anonymous"
    />
  </head>

  <body>
    <div class="container-gx0">
      <!-- <div class="row" style="height: 30px;"></div> -->
      <div class="row" id="title"><h1>Sound Mate Spotify</h1></div>
      <div class="row" id="w">
        <div class="col-2"></div>
        <div class="col-8">
          Choose which playlsit to analyze:
          <form action="/query" method="post">
            <label for="dropdown">Select a playlist to analyze:</label>
            <select id="dropdown" name="selected-value"></select>
            <input type="submit" value="Submit" />
          </form>
        </div>
        <div class="col-2"></div>
      </div>
      <div class="row" id="nav-bar">
        <ul>
          <li><a href="#gen">General</a></li>
          <li><a href="#dance">Danceability</a></li>
          <li><a href="#valence">valence</a></li>
          <li><a href="#liveness">Liveness</a></li>
          <li><a href="#energy">Energy</a></li>
          <li><a href="#speechiness">Speechiness</a></li>
        </ul>
      </div>
      <div class="row" id="content">
        <div id="gen">
          <h2>General Overview</h2>
        </div>
        <div class="row" id="dance">
          <div class="col" id="d1">
            <h2>Danceability</h2>
          </div>
          <div class="col" id="d2">sdf</div>
        </div>
        <div class="row" id="valence">
          <div class="col" id="v1">
            <h2>Valence</h2>
          </div>
          <div class="col" id="v2">ff</div>
        </div>
        <div class="row" id="liveness">
          <div class="col" id="l1">
            <h2>Liveness</h2>
          </div>
          <div class="col" id="l2"></div>
        </div>
        <div class="row" id="energy">
          <div class="col" id="e1">
            <h2>Energy</h2>
          </div>
          <div class="col" id="e2">ff</div>
        </div>
        <div class="row" id="speechiness">
          <div class="col" id="s1">
            <h2>Speechiness</h2>
          </div>
          <div class="col" id="s2"></div>
        </div>
      </div>
    </div>
    <div id="data">{{ data }}</div>
  </body>

  <script>
    var dropdownContent = document.getElementById("dropdown");
    // if select has no options, or if new playlist data is being passed into the display file,
    // update the options
    if (dropdownContent.innerHTML === '' && {{ json_playlist_dropdown_items|tojson|safe }} != undefined) {
      var playlistDropdownItems = {{ json_playlist_dropdown_items|tojson|safe }};
      var playlistDropdownItemsMap = JSON.parse(playlistDropdownItems);
      dropdownContent.innerHTML = '';

      for (const key in playlistDropdownItemsMap) {
        var dropdownContent = document.getElementById("dropdown");
        var option = document.createElement("option");
        option.value = playlistDropdownItemsMap[key];
        option.text = key;
        dropdownContent.appendChild(option);
      }
    }

    /*
    addEventListener("DOMContentLoaded", (event) => {});
    onDOMContentLoaded = (event) => {
      let dropdownContent = document.getElementById("dropdown");
      dropdownContent.innerHTML = "";
      playlist_dropdown_items_map.forEach((playlist_name, playlist_id) => {
        var option = document.createElement("option");
        option.textContext = playlist_name;
        option.id = playlist_id;
        dropdownContent.appendChild(option);
      });
    };
    */

    /*
    function fetchPlaylistTrackFeatures() {
      let selected = document.getElementById("").value;
      let startDate = document.getElementById("start-date").value;
      let endDate = document.getElementById("end-date").value;
      let searchParams = "/statistics?" + new URLSearchParams({player_name: name, start_date: startDate, end_date: endDate});

      const responsePromise = fetch(searchParams, {
        method: "GET",
        headers: {
          "Content-type": "application/json; charset=UTF-8"
        }
      });
      responsePromise.then(
        // Fulfilled
        async (response) => {
          document.getElementById("statistics-table").style.visibility = "visible";
          populateStatsTable(await response.json());
        },
        // Error
        (error) => {
          alert("Cannot obtain tournaments")
        })
    }
    */

    // how do we pass in the playlist name here?
  </script>
</html>
