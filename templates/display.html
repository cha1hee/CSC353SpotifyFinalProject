<!DOCTYPE html>
<html lang="en">
  <head>
    <title>CSC353 Final Project</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../styles.css"/>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We"
      crossorigin="anonymous"
    />
    <script src="https://d3js.org/d3.v7.min.js"></script>

  </head>

  <body onload()="getPlaylistNames()">
    <div class="container-gx0">
      <!-- <div class="row" style="height: 30px;"></div> -->
      <div class="row" id="title"><h1>Sound Mate Spotify</h1></div>
      <div class="row" id="w">
        <div class="col-2"></div>
        <div class="col-8">
          Choose which playlsit to analyze:
          <div class="dropdown">
            <button class="dropbtn">Select</button>
            <div class="dropdown-content">
              <a href="#">Playlist 1</a>
              <a href="#">Playlist 2</a>
              <a href="#">Playlist 3</a>
            </div>
          </div>
        </div>
        <div class="col-2"></div>
      </div>
      <div class="row" id="nav-bar">
        <ul>
          <li><a href="#gen">General</a></li>
          <li><a href="#dance">Danceability</a></li>
          <li><a href="#valence">valence</a></li>
          <li><a href="#liveness">Liveness</a></li>
          <li><a href="#energy">Energy</a></li>                                                 
          <li><a href="#speechiness">Speechiness</a></li>
        </ul>
      </div>
      <div class="row" id="content">
        <div id="gen">
          <h2>General Overview</h2>
        </div>
        <div class="row" id="dance">
          <div class="col" id="d1">
            <h2>Danceability</h2>
          </div>
          <div class="col" id="d2">sdf</div>
        </div>
        <div class="row" id="valence">
          <div class="col" id="v1">
            <h2>Valence</h2>
          </div>
          <div class="col" id="v2">ff</div>
        </div>
        <div class="row" id="liveness">
          <div class="col" id="l1">
            <h2>Liveness</h2>
          </div>
          <div class="col" id="l2"></div>
        </div>
        <div class="row" id="energy">
          <div class="col" id="e1">
            <h2>Energy</h2>
          </div>
          <div class="col" id="e2">ff</div>
        </div>
        <div class="row" id="speechiness">
          <div class="col" id="s1">
            <h2>Speechiness</h2>
          </div>
          <div class="col" id="s2"></div>
        </div>
      </div>
    </div>

    </body>

    <!-- script for spider plot  -->
    <script>
      // example data
      let data = [];
      let features = ["Danceability", "Valence", "Liveness", "Energy", "Speechiness"];
      // get the data points and push into data
      for(var i=0; i<1; i++){
          var point={}
          features.forEach(f=> point[f] = 1+Math.random() * 9);
          data.push(point);
      }

      console.log(data)
      // setting up svg
      let width = 700;
      let height = 600;
      let svg = d3.select("#gen").append("svg")
          .attr("width", width)
          .attr("height", height);
      // plot gridlines
      let radialScale = d3.scaleLinear()
          .domain([0,10])
          .range([0,250]);
      let ticks = [1, 2, 3, 4, 5, 6, 7, 8, 9];
      // make the circles to indicate value
      svg.selectAll("circle")
          .data(ticks)
          .join(
              enter => enter.append("circle")
                  .attr("cx", width / 2)
                  .attr("cy", height / 2)
                  .attr("fill", "none")
                  .attr("stroke", "gray")
                  .attr("r", d=> radialScale(d))
          );
      // add labels
      svg.selectAll(".ticklabel")
          .data(ticks)
          .join(
              enter => enter.append("text")
                  .attr("class", "ticklabel")
                  .attr("x", width / 2 + 5)
                  .attr("y", d => height / 2 - radialScale(d))
                  .text(d => "0.".concat(d.toString()))
          );
      // plot axes
      function angleToCoordinate(angle, value){
          let x = Math.cos(angle) * radialScale(value);
          let y = Math.sin(angle) * radialScale(value);
          return {"x": width / 2 + x, "y": height / 2 - y};
      }
      let featureData = features.map((f, i) => {
          let angle = (Math.PI / 2) + (2 * Math.PI * i / features.length);
          return {
              "name": f,
              "angle": angle,
              "line_coord": angleToCoordinate(angle, 10),
              "label_coord": angleToCoordinate(angle, 10.5)
          };
      });
      // draw axis line
      svg.selectAll("line")
          .data(featureData)
          .join(
              enter => enter.append("line")
                  .attr("x1", width / 2)
                  .attr("y1", height / 2)
                  .attr("x2", d => d.line_coord.x)
                  .attr("y2", d => d.line_coord.y)
                  .attr("stroke", "black")
          );
      // draw axis label
      svg.selectAll(".axislabel")
          .data(featureData)
          .join(
              enter => enter.append("text")
                  .attr("x", d => d.label_coord.x)
                  .attr("y", d => d.label_coord.y)
                  .text(d => d.name)
          );
      // plot data
      let line = d3.line()
          .x(d => d.x)
          .y(d => d.y);
      let colors = ["darkorange", "gray", "nave"];

      function getPathCoordinates(data_point){
          let coordinates = [];
          for(var i = 0; i< features.length; i++){
              let ft_name = features[i];
              let angle = (Math.PI / 2) + (2 * Math.PI * i / features.length);
              coordinates.push(angleToCoordinate(angle, data_point[ft_name]));
          }
          return coordinates;
      }
      // draw path between data points
      svg.selectAll("path")
          .data(data)
          .join(
              enter => enter.append("path")
                  .datum(d => getPathCoordinates(d))
                  .attr("d", line)
                  .attr("stroke-width", 3)
                  .attr("stroke", (_, i) => colors[i])
                  .attr("fill", (_, i) => colors[i])
                  .attr("stroke-opacity", 1)
                  .attr("opacity", 0.5)
          );
  </script>

  <!-- script for barchart -->
  

    <script>
      function getPlaylistNames() {
        const responsePromise = fetch("/playlist?name", {
          // get all the names in playlist table"
          method: "GET",
          headers: {
            "Content-type": "application/json; charset=UTF-8",
          },
        });

        responsePromise.then(
          // Fulfilled
          async (response) => {
            populateList(await response.json());
          },
          // Error
          (error) => {
            alert("Cannot obtain playlists");
          }
        );
        console.log("testing that it works for non list");
      }
  </script>
</html>
